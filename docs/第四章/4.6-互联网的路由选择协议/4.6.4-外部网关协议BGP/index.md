# 4.6.4 外部网关协议 BGP (Border Gateway Protocol)

## 1. 协议特点

- **背景**：AS之间路由选择困难（策略不同、规模太大）。
- **类型**：**路径向量 (Path Vector)** 路由协议。
- **目标**：寻找一条 **能够到达目的网络** 且 **比较好** 的路由（不兜圈子），而非寻找最佳路由。
- **层级**：应用层协议（封装在 **TCP** 连接中，端口179）。

## 2. 工作原理

- **BGP 发言者 (BGP Speaker)**：每个AS选择至少一个路由器作为代表。
- **交换信息**：两个BGP发言者建立TCP连接，交换路由信息（路径向量）。
- **路径向量内容**：例如 `[目标网络N, 路径: AS1 -> AS3 -> AS5]`。
- **防环机制**：如果路由器在收到的路径属性中看到了自己的AS号，说明有环路，直接丢弃。

## 3. BGP 报文

- **OPEN**: 建立关系。
- **UPDATE**: 发送路由信息（增加或撤销）。
- **KEEPALIVE**: 周期性保活。
- **NOTIFICATION**: 报错关闭。

## 交互式演示

下面是一个交互式演示，可以观察 BGP 协议的路由通告过程和 AS-PATH 的构建：

<BGPSimulation />

