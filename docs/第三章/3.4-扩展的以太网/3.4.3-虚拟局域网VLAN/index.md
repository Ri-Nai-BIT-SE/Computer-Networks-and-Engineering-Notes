# 3.4.3 虚拟局域网（VLAN）

## VLAN的概念

### 定义
- **VLAN（Virtual LAN）**：虚拟局域网
- **特点**：逻辑上划分的网络，不受物理位置的限制

### 目的
- 将一个物理局域网划分成多个逻辑局域网
- 每个VLAN是一个独立的广播域

## VLAN的作用 ⭐ **必考概念辨析**

### 核心作用：隔离广播域
- **VLAN隔离广播域**（抑制广播风暴）⭐
- **注意区分**（老师强调）：
  - **交换机**：隔离**碰撞域**（每个端口一个碰撞域）
  - **VLAN**：隔离**广播域**（每个VLAN一个广播域）
- **概念要准**：VLAN是逻辑隔离，不是物理隔离

## VLAN的优点

### 1. 隔离广播风暴
- 广播帧只在同一个VLAN内传播
- 不同VLAN之间不能直接通信
- **作用**：抑制广播风暴，提高网络性能

### 2. 提高安全性
- 不同VLAN之间的通信需要经过路由器
- 可以设置访问控制策略

### 3. 灵活的网络管理
- 可以根据部门、功能等逻辑关系划分VLAN
- 不受物理位置的限制

### 4. 提高网络性能
- 减少广播流量
- 提高网络利用率

## VLAN的划分方法

### 1. 基于端口
- 根据交换机的端口划分VLAN
- 最简单、最常用的方法

### 2. 基于MAC地址
- 根据MAC地址划分VLAN
- 用户移动位置时，VLAN不变

### 3. 基于IP地址
- 根据IP地址划分VLAN
- 需要三层交换机支持

### 4. 基于协议
- 根据网络层协议划分VLAN

## 802.1Q帧格式 ⭐ **选择题考点**

### 定义
- **802.1Q**：IEEE 802.1Q标准，定义了VLAN的帧格式
- **标记帧（Tagged Frame）**：带有VLAN标记的帧

### 帧格式
```
| 目的地址 | 源地址 | 802.1Q标记 | 类型 | 数据 | FCS |
|  6字节  | 6字节  |   4字节    | 2字节| 数据 | 4字节 |
```

**插入位置**：802.1Q标记插入在**源MAC地址**和**类型字段**之间 ⭐

### 802.1Q标记字段（4字节）
```
| TPID (2字节) | TCI (2字节) |
|   0x8100     | PCP | DEI | VID (12位) |
```

#### 各字段说明
- **TPID（Tag Protocol Identifier）**：标记协议标识符，固定为0x8100
- **PCP（Priority Code Point）**：优先级代码点，3位
- **DEI（Drop Eligible Indicator）**：丢弃合格指示符，1位
- **VID（VLAN Identifier）**：VLAN标识符，12位，可标识4096个VLAN（0和4095保留）

### 工作原理
1. **发送端**：在帧中插入4字节的802.1Q标记
2. **传输**：标记帧在支持VLAN的交换机之间传输
3. **接收端**：根据VID确定帧属于哪个VLAN

### 注意事项 ⭐
- **插入标记后，帧的最大长度变为1522字节**（原1518字节 + 4字节标记）⭐
- 需要支持802.1Q的交换机才能处理标记帧
- **考试重点**：802.1Q帧在源MAC和类型之间插入**4字节**标记 ⭐

