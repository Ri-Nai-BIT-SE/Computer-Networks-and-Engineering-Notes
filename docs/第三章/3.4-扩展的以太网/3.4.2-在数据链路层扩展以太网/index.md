# 3.4.2 在数据链路层扩展以太网

## 以太网交换机（Switch）

### 定义
- 工作在数据链路层的设备
- 也称为**多端口网桥**

### 特点

#### 1. 全双工通信
- 每个端口可以同时发送和接收数据
- 不存在碰撞问题

#### 2. 独占带宽
- 每个端口独占带宽
- 例如：10Mbps交换机，每个端口都是10Mbps

#### 3. 自学习算法建立交换表
- 交换机通过自学习算法建立MAC地址与端口的映射关系
- 交换表记录每个MAC地址对应的端口

### 自学习算法 ⭐ **必考分析题**

#### 工作原理（老师强调流程）⭐ **一定要搞清**
1. **初始状态**：交换表为空
2. **接收帧**：从某个端口收到帧
3. **学习过程**（先看**源MAC**）：
   - 提取帧的**源MAC地址**
   - 如果交换表中没有该MAC地址，就**登记**（源MAC + 进入的接口号）
   - 如果交换表中已有该MAC地址，则**更新**该表项的时间戳
4. **转发过程**（再看**目的MAC**）：
   - **目的MAC在表中**：点对点转发（明确发往对应接口）
   - **目的MAC不在表中**：**泛洪/广播**（发往除入口外的所有接口）
   - **目的MAC是广播地址**（全1）：广播到除接收端口外的所有端口

#### 交换表的维护
- **老化机制**：交换表中的表项有过期时间（通常几分钟）
- **更新**：如果收到来自某个MAC地址的帧，则更新该表项的时间戳

#### 易错点 ⚠️ **考试重点**
1. **初次通信必须广播**：
   - 交换表初始为空，收到A发给B的帧时
   - 先学习：记录A的MAC地址和进入端口
   - 再转发：因为B不在表中，必须**广播**到除入口外的所有端口

2. **同接口不转发**：
   - 如果源和目的在同一个接口（例如接在同一个Hub上）
   - 交换机会选择**丢弃**不转发（因为目标主机已经通过Hub收到了）

3. **学习与转发的顺序**：
   - **必须先学习源MAC，再转发目的MAC**
   - 不能混淆顺序

#### 典型考题 ⭐ **必考题型**
- 给出A发给B，C发给D的顺序，问：
  1. 交换表中增加了哪些条目？
  2. 特定的帧是否会转发到某个端口？
  3. 转发方式是点对点还是广播？

### 交换机的优点
1. **隔离碰撞域**：每个端口是一个独立的碰撞域
2. **提高总吞吐量**：多个端口可以同时通信
3. **支持全双工**：每个端口可以全双工通信
4. **安全性**：可以隔离广播域（通过VLAN）

## 生成树协议（STP - Spanning Tree Protocol）

### 目的
- 消除网络中的回路（loop）
- 防止广播风暴

### 原理
- 在具有物理回路的网络中，通过算法选择一条逻辑路径
- 阻塞某些端口，使网络形成树形结构（无回路）

### 工作过程
1. **选举根桥**：选择优先级最高的交换机作为根桥
2. **选择根端口**：每个非根交换机选择一个根端口
3. **选择指定端口**：每个网段选择一个指定端口
4. **阻塞其他端口**：其他端口被阻塞

### 优点
- 消除回路，防止广播风暴
- 提供冗余路径（当主路径故障时，可以启用备用路径）

