# 3.1.2 三个基本问题

数据链路层有三个基本问题，这是所有数据链路层协议都需要解决的。

## 1. 封装成帧（Framing）

### 定义
- 在一段数据的前后分别添加首部和尾部，构成一个帧
- 首部和尾部的一个重要作用就是进行**帧定界**（确定帧的界限）

### 帧定界符
- **SOH（Start Of Header）**：帧开始符，ASCII码为0x01
- **EOT（End Of Transmission）**：帧结束符，ASCII码为0x04
- 接收端通过识别这些特殊字符来确定帧的开始和结束

### MTU（Maximum Transfer Unit）
- **定义**：最大传输单元，即帧的数据部分的最大长度
- **作用**：限制帧的大小，避免帧过大导致传输问题
- **常见值**：以太网的MTU为1500字节

## 2. 透明传输（Transparent Transmission）

### 问题
- 如果数据部分恰好出现了帧定界符（如SOH或EOT），接收端会误认为这是帧的边界

### 解决方案：字节填充（Byte Stuffing）
- **发送端**：在数据中出现控制字符（如SOH、EOT）的前面插入一个转义字符（ESC，ASCII码为0x1B）
- **接收端**：删除转义字符，恢复原始数据
- **也称为**：字符填充（Character Stuffing）

### 示例
- 原始数据：`A B ESC EOT C`
- 发送端填充后：`A B ESC ESC ESC EOT C`
- 接收端处理后：`A B ESC EOT C`（恢复原始数据）

### 零比特填充（PPP协议同步传输）
- **适用场景**：PPP协议在同步传输时使用零比特填充
- **规则**：
  - **发送端**：只要发现5个连续的1，立即填入1个0
  - **接收端**：只要发现5个连续的1，把后面的0删掉
- **示例**：
  - 原始数据：`01111110`
  - 发送端填充后：`011111010`（5个1后插入0）
  - 接收端处理后：`01111110`（删除5个1后的0）

## 3. 差错检测（Error Detection）

### 误码率（BER - Bit Error Rate）
- **定义**：传输错误的比特数占所传输比特总数的比率
- **说明**：实际信道的误码率可能达到 $10^{-4}$ 或更高

### 循环冗余检验（CRC - Cyclic Redundancy Check）⭐ **必考计算题**

#### 原理
- 在数据后面添加冗余码（帧检验序列FCS）
- 接收端用同样的方法计算，如果结果不一致，说明传输有误

#### 计算步骤 ⭐ **老师强调点**
1. **确定生成多项式**：例如 $P(X) = X^3 + X^2 + 1$，对应的二进制为 `1101`（4位）
2. **补0**：在数据后面添加 $r$ 个0（$r$ 为生成多项式的最高次幂，即生成多项式对应的二进制位数减1）
   - 例如：$P(X) = X^3 + X^2 + 1$，最高次幂为3，补3个0
   - **老师强调**：生成多项式最高次幂是几（$n$），就在数据后面补几个0
3. **模2除法**：用生成多项式对应的二进制数去除补0后的数据
   - **模2运算本质**：异或运算（相同为0，不同为1），**不借位、不进位**
   - 除数位数 = 生成多项式对应的二进制位数 = $n+1$（$n$为最高次幂）
   - **老师强调**：模2除法本质是异或运算，不借位
4. **得到余数**：余数就是FCS（帧检验序列）
   - **重要**：余数位数必须补齐到 $r$ 位（例如余数是1，但$r=3$，则FCS为 `001`）
   - **老师强调**：余数位数必须补齐 $n$ 位（例如余数是1，但$n=3$，则FCS为 `001`）
5. **组成发送帧**：原始数据 + FCS

#### 模2除法详解
- **本质**：异或运算，逐位相减（相同为0，不同为1）
- **特点**：不借位、不进位，只做异或
- **示例**：
  ```
  被除数：101001000（数据101001补3个0）
  除数：  1101（对应X³+X²+1）
  
  计算过程：
    101001000
    1101
    --------
    011101000
    1101
    --------
    001001000
    1101
    --------
    000100000
    1101
    --------
    000001000
    0000
    --------
    000001000
    1101
    --------
    000000101（余数）
  ```
  FCS = `101`（如果$r=3$，已经是3位，无需补0）

#### 易错点 ⚠️ **考试常错**
- **补0个数错误**：应该补生成多项式最高次幂个0，不是二进制位数
- **余数位数不足**：余数必须补齐到$r$位（前面补0）
- **混淆模2除法和普通除法**：模2除法是异或运算，不借位不进位
- **除数位数错误**：除数位数 = 生成多项式对应的二进制位数 = $n+1$

#### 生成多项式
- 常用的生成多项式：
  - CRC-16: $x^{16} + x^{15} + x^2 + 1$
  - CRC-CCITT: $x^{16} + x^{12} + x^5 + 1$
  - CRC-32: $x^{32} + x^{26} + x^{23} + x^{22} + x^{16} + x^{12} + x^{11} + x^{10} + x^8 + x^7 + x^5 + x^4 + x^2 + x + 1$

#### 帧检验序列（FCS - Frame Check Sequence）
- **定义**：在数据后面添加的冗余码
- **长度**：通常为16位或32位
- **作用**：用于检测帧在传输过程中是否出现差错

#### 检错能力
- CRC可以检测出：
  - 所有单比特错误
  - 所有双比特错误
  - 所有奇数个比特错误
  - 所有长度小于等于 $r$ 的突发错误
- **注意**：CRC只能检错，不能纠错

