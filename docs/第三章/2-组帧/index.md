# 3.2 组帧 (Framing)

物理层传输的是原始的比特流，数据链路层的一项基本功能就是将这些比特流组合成逻辑上离散的传输单元——**帧 (Frame)**。本节介绍实现组帧的四种主要方法。

### 核心概念

**组帧 (Framing)**：将来自网络层的IP数据报封装成帧，并在帧的头部和尾部添加必要的控制信息，以便在链路上进行传输和识别。

#### 1. 字符计数法 (Character Count)

*   **原理**: 在帧的头部使用一个字段来标明该帧包含的字符（或字节）总数。
*   **示例**:
    *   `6` `01234` `6` `56789` `9` `01234567`
    *   第一个帧包含6个字符（包括计数本身），第二个帧也是6个，第三个是9个。
*   **缺点**: **致命的脆弱性**。如果头部的计数字段在传输中出错（例如，`6` 变成了 `7`），接收方就会失去同步，导致后续所有帧的边界都判断错误，造成灾难性后果。因此，这种方法现已很少使用。

#### 2. 带字符填充的首尾字符定界法 (Character Stuffing)

*   **原理**: 使用一个特殊的字符（如 `FLAG`）来标记一帧的开始和结束。
*   **问题**: 如果数据部分本身就包含了 `FLAG` 字符，接收方会误判为帧的结束。
*   **解决方案 (字符填充)**:
    *   在发送端，扫描数据部分，如果在数据中发现 `FLAG` 字符，就在其前面插入一个特殊的**转义字符 (ESC)**。
    *   如果在数据中发现 `ESC` 字符，同样在其前面再插入一个 `ESC` 字符。
    *   在接收端，进行反向操作。当收到 `ESC` 时，就删除它，并将其后面的字符当作普通数据。
*   **缺点**: 依赖于特定的字符编码（如8位ASCII），不通用。

#### 3. 带位填充的首尾标记定界法 (Bit Stuffing)

*   **原理**: 使用一个特殊的位模式，如 `01111110` (称为**标志 Flag**)，来标记帧的开始和结束。
*   **问题**: 如果数据部分包含 `01111110`。
*   **解决方案 (零比特填充)**:
    *   **发送端**: 扫描数据部分，只要遇到**连续的5个`1`**，就**自动在其后插入一个`0`**。
    *   **接收端**: 扫描数据流，只要发现**连续的5个`1`**，就检查其后的比特。
        *   如果后面是`0`，则**删除**这个`0`（因为它是被填充进去的）。
        *   如果后面是`1`，再看下一位。若为`0`，则是帧的结束标志 `01111110`。
*   **优点**: 透明、通用，不依赖于任何字符编码。是 **HDLC** 和 **PPP** 等重要协议采用的方法。

#### 4. 物理层编码违例法 (Physical Layer Coding Violation)

*   **原理**: 利用物理层编码中的**冗余**。
*   **前提**: 只适用于那些编码方案本身有冗余的网络。
*   **示例 (曼彻斯特编码)**:
    *   在曼彻斯特编码中，`高-低` 电平跳变表示 `1`，`低-高` 电平跳变表示 `0`。
    *   `高-高` 和 `低-低` 这两种电平组合在数据中是**不会出现**的，是"违例"的。
    *   因此，可以利用这些违例码序列来定义帧的开始和结束。
*   **应用**: IEEE 802局域网标准。

### 易考点 & 难点

*   **易考点**:
    *   四种组帧方法的名称和基本原理。
    *   字符计数法的致命缺点。
*   **难点**:
    *   **零比特填充/删除的过程**：这是本节最重要、最常考的内容。必须熟练掌握发送端如何填充`0`，以及接收端如何根据`5个1`后面的比特来决定是删除`0`还是识别为帧边界。
    *   **字符填充/删除的过程**: 理解转义字符（ESC）如何解决数据与标志字符冲突的问题，包括对转义字符本身的处理。
