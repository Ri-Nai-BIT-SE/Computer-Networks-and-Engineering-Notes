# 1.5 网络的体系结构

本节是计算机网络的核心内容之一，通过分层通信的例子引入了网络分层的概念，并详细解释了层、服务、接口和协议等关键术语，最后通过一个构建局域网的案例展示了分层设计的妙处。

### 核心概念

#### 1. 分层通信的例子

*   **示例**：A先生和B先生（高层应用）通过翻译（中间层服务）和工程技术人员（底层传输）进行跨语言交流。
*   **启示**：
    *   **协议 (Protocol)**：对等层之间通信时遵守的规则（如A先生和B先生的共同兴趣和认识）。
    *   **服务 (Service)**：下层向上层提供的功能（如翻译提供语言翻译服务）。
    *   **接口 (Interface)**：相邻层之间进行交互的临界处。

#### 2. 层（Layer）

*   **设计思想**：采用信息隐蔽、抽象数据类型和面向对象设计方法。
*   **目的**：向上层提供服务。上层可以使用下层服务，但对其内部状态和算法不可见。

#### 3. 服务（Service）

*   **定义**：下层（n-1层）向上层（n层）提供的功能。
*   **方向**：垂直方向。

#### 4. 接口（Interface）

*   **定义**：存在于每一对相邻层之间的临界处。
*   **作用**：下层通过接口向上层提供服务。

#### 5. 协议（Protocol）

*   **定义**：对等层关于如何进行通信的一种规则约定，是对该层功能如何实现的一种定义。
*   **方向**：水平方向，控制对等实体之间的通信。
*   **特点**：
    *   必须考虑所有不利条件，不能假定一切正常。
    *   要仔细检查能否应对各种异常情况。
    *   **著名例子**：蓝军协同作战问题，证明没有100%可靠的协议能保证双方都收到确认，因为确认本身也可能丢失，导致无限循环。

#### 6. 服务的类型

*   **面向连接服务 (Connection-oriented)**：
    *   **特点**：通信前需要建立连接，通信完成后释放连接。
    *   **阶段**：连接建立 -> 数据传输 -> 连接释放。
    *   **示例**：电话网络服务模型。
*   **无连接服务 (Connectionless)**：
    *   **特点**：通信前不需要建立连接。每个报文都携带完整的目标地址，系统独立路由。
    *   **示例**：邮政网络服务模型。

#### 7. 服务原语

*   **定义**：一组操作，用户进程通过这些操作可以访问某一层提供的服务。
*   **常见原语**：
    *   `LISTEN`：阻塞等待进入连接。
    *   `CONNECT`：建立连接。
    *   `RECEIVE`：阻塞等待报文。
    *   `SEND`：发送报文。
    *   `DISCONNECT`：终止连接。

#### 8. 设计局域网的网络层次结构

*   **问题**：如何让多台自主计算机（运行应用程序）通过共享介质（广播式）进行通信，同时不更改固有硬件设计，但可增加新硬件及驱动？
*   **解决方案**：分层设计。

    *   **第一步：物理层**
        *   **功能**：在对等物理层之间协商传输介质、电压/脉冲信号表示0/1、将逻辑数字信息转换为物理信号传输。
        *   **问题**：无法解决信道竞争、寻址、冲突调解、多应用程序识别等问题。

    *   **第二步：数据链路层**
        *   **功能**：在物理层之上，负责寻址和信道的竞争控制、冲突调解。
        *   **机制**：指定协议（如CSMA/CD），设定**物理地址 (MAC地址)** 标识每台机器。MAC地址烧录在网卡 (NIC) 芯片中，全球唯一。
        *   **硬件实现**：**网卡 (NIC)** 实现了数据链路层和物理层的功能。
        *   **问题**：解决了计算机间的直接通信问题，但无法解决一台计算机上多个应用程序的通信问题，也无法协调不同速度的计算机。

    *   **第三步：传输层**
        *   **功能**：
            *   **应用程序标识**：通过端口号等机制区分不同应用程序。
            *   **速度协调**：流量控制机制。
            *   **端到端正确传输**：提供可靠性（如重传机制）或不可靠性服务。
        *   **位置**：介于应用程序与网络层之间，负责进程到进程的通信。

#### 9. 设计广域网的网络层次结构

*   **问题**：已存在多种局域网，如何设计广域网体系结构，实现局域网之间的互通，同时不更改现有局域网设计，但可增加新硬件？
*   **解决方案**：再设计一个**网络层**。
    *   **网络层**：负责实现局域网之间的互通，提供路由选择和转发功能。

#### 10. 分层的好处

*   **各层独立**：每层只关心自己的功能，简化了设计。
*   **灵活性好**：修改一层不会影响其他层。
*   **结构可分割**：便于实现和维护。
*   **易于标准化**：促进不同厂商设备互操作。
*   **层数适当**：太少协议复杂，太多困难。

#### 11. 计算机网络的体系结构

*   **定义**：计算机网络的各层及其协议的集合。是对网络及其部件应完成功能的精确定义。
*   **实现 (Implementation)**：遵循体系结构的前提下，用硬件或软件完成这些功能。
*   **关系**：体系结构是抽象的，实现是具体的。

#### 12. 五层协议的体系结构

这是TCP/IP协议族在概念上的分层模型，是理解网络通信过程的常用模型。

| 层数 | 名称       | 主要功能                                                                                              | PDU (协议数据单元)            |
| :--- | :--------- | :---------------------------------------------------------------------------------------------------- | :---------------------------- |
| 5    | **应用层** | 为应用程序提供网络服务，处理特定应用细节（HTTP、FTP、DNS等）。                                      | 应用程序数据（或报文）        |
| 4    | **传输层** | 负责端到端（进程到进程）的数据传输，提供可靠（TCP）或不可靠（UDP）的服务，进行流量控制和差错控制。 | 传输层报文段（Segment/Datagram） |
| 3    | **网络层** | 负责将分组从源主机路由到目的主机，处理IP寻址和路由选择。                                            | IP数据报（Packet/Datagram）    |
| 2    | **数据链路层** | 负责点到点之间的帧传输，进行差错检测和纠正，介质访问控制。                                        | 帧（Frame）                   |
| 1    | **物理层** | 在物理传输介质上传输比特流，定义电压、接口等物理特性。                                              | 比特（Bit）                   |

#### 13. 数据发送过程中的封装和解封装

*   **发送端**：应用程序数据 -> 应用层添加首部 (H5) -> 传输层添加首部 (H4) -> 网络层添加首部 (H3) -> 数据链路层添加首部 (H2) 和尾部 (T2) -> 物理层转换为比特流传输。
*   **接收端**：物理层接收比特流 -> 数据链路层剥去 H2 和 T2 -> 网络层剥去 H3 -> 传输层剥去 H4 -> 应用层剥去 H5 -> 应用程序数据。
*   **关键点**：每层都将上层的数据视为自己的"数据载荷"，并为其添加本层的"协议控制信息"（首部/尾部）。

#### 14. 实体、协议、服务和服务访问点

*   **实体 (Entity)**：任何可发送或接收信息的硬件或软件进程。
*   **协议 (Protocol)**：控制两个**对等实体**通信的规则集合（**水平的**）。
*   **服务 (Service)**：下层向上层提供的功能（**垂直的**）。
*   **服务访问点 (SAP - Service Access Point)**：同一系统相邻两层实体进行交互的地方，是一个逻辑地址，用于标识某个服务。

### 易考点 & 难点

*   **易考点**：
    *   层、服务、接口、协议这四个核心概念的定义和相互关系。
    *   五层协议体系结构中各层的功能、PDU名称。
    *   数据发送和接收过程中的封装（加首部/尾部）和解封装（剥去首部/尾部）过程。
    *   面向连接服务和无连接服务的区别。
*   **难点**：
    *   理解协议是"水平的"而服务是"垂直的"含义。
    *   服务访问点 (SAP) 的概念。
    *   蓝军协议问题揭示的100%可靠通信的困境。