# 2.1.6 交换的概念

#### 一、交换的定义与作用

* **交换 (Switching)**：核心含义是"转接"，即将一条线路转接到另一条线路上，使它们连通。
* **资源分配角度**：从通信资源分配的角度看，交换是按照某种方式动态地分配传输线路的资源。

### 核心概念

#### 1. 交换的基本概念

*   **定义**: 网络中实现动态分配传输线路资源的方法，使用户可以按需通过网络设备连接到不同的目标设备。
*   **目的**: 避免用户之间需要建立大量的直连线路（$N$ 个节点需要 $N(N-1)/2$ 条线路）。
*   **类型**: 主要包括电路交换、报文交换和分组交换三种技术。

#### 2. 电路交换 (Circuit Switching)

*   **模型**: 传统电话网。
*   **原理**: 在通信双方之间建立一条**专用的物理通路**。
*   **三个阶段**:
    1.  **建立连接**: 在通信双方之间建立专用的物理通路。
    2.  **通信**: 双方独占这条通路进行通信，直到结束。
    3.  **释放连接**: 拆除该通路，释放资源。
*   **优点**:
    *   通信时延小（一旦建立连接）。
    *   数据传输有序，无失序问题。
    *   实时性好，适合语音等连续数据传输。
*   **缺点**:
    *   线路利用率低（独占资源）。
    *   建立连接时间长。
    *   灵活性差，一旦链路故障，整个连接中断。

#### 3. 报文交换 (Message Switching)

*   **模型**: 早期电报网。
*   **原理**: 采用**存储转发**方式。
*   **过程**:
    *   将整个报文作为一个单元发送。
    *   中间节点接收到**完整报文**后，先存储，再查找路由表，转发给下一个节点。
*   **优点**:
    *   无需建立连接，线路利用率高。
    *   可以实现多路径选择，可靠性高。
*   **缺点**:
    *   时延大（必须等待完整报文）。
    *   对中间节点的缓存容量要求高。

#### 4. 分组交换 (Packet Switching)

*   **模型**: 现代计算机网络（因特网）。
*   **原理**: **存储转发**，但以较小的**分组**为单位。
*   **过程**:
    1.  发送端将长报文分割成多个较小的数据块（分组）。
    2.  为每个分组添加控制信息的首部。
    3.  中间节点（路由器）接收、存储、查表、转发分组。
*   **优点**:
    *   效率高（动态分配带宽）。
    *   灵活（无需建立连接，分组独立选路）。
    *   可靠（完善的协议和自适应路由）。
    *   时延小（分组短小，形成"流水线"传输）。
*   **缺点**:
    *   存在排队时延和拥塞问题。
    *   分组需要额外首部开销。
    *   可能出现分组失序、丢失等问题。

#### 5. 分组交换的两种服务方式

*   **数据报服务 (Datagram)**:
    *   **特点**: 无连接服务。
    *   **原理**: 每个分组独立选路，携带完整的目的地址。
    *   **结果**: 分组可能失序到达。
    *   **应用**: IP协议。

*   **虚电路服务 (Virtual Circuit)**:
    *   **特点**: 面向连接服务。
    *   **原理**: 建立逻辑连接，确定路径，分组携带虚电路标识。
    *   **结果**: 分组按序到达。
    *   **应用**: ATM、帧中继。

### 三、分组交换中的时延

一个分组在路由器节点产生的总时延 $d_{nodal}$ 由四部分组成：
$d_{nodal} = d_{proc} + d_{queue} + d_{trans} + d_{prop}$

1.  **节点处理时延 ($d_{proc}$)**：路由器检查分组的比特差错、从首部提取目的地址并查找路由表以决定输出链路所花费的时间。
2.  **排队时延 ($d_{queue}$)**：分组在输出链路的队列中等待被传输的时间。该时延取决于网络的拥塞程度。
3.  **传输时延 ($d_{trans}$)**：将分组的所有比特推向（发送到）链路所需要的时间。
    *   公式：$d_{trans} = L/R$
    *   其中，$L$ 是分组长度（比特），$R$ 是链路带宽（bps）。
4.  **传播时延 ($d_{prop}$)**：一个比特从链路的一端传播到另一端所需的时间。
    *   公式：$d_{prop} = d/s$
    *   其中，$d$ 是物理链路的长度，$s$ 是信号在介质中的传播速度（约 $2 \times 10^8$ m/s）。

*   **流量强度与排队时延**：
    *   流量强度定义为 $La/R$，其中 $a$ 是分组的平均到达速率。
    *   当 $La/R \to 0$ 时，排队时延很小。
    *   当 $La/R \to 1$ 时，排队时延迅速增大。
    *   当 $La/R > 1$ 时，进入队列的分组速率超过了处理速率，队列无限增长，时延将趋于无穷大。

*   **分组丢失 (Packet Loss)**：
    *   路由器的队列（缓存）容量是有限的。
    *   当一个分组到达时，如果队列已满，该分组将被**丢弃 (Lost)**。

### 四、三种交换方式的比较

| 项目 | 电路交换 | 报文交换 | 分组交换 |
| :--- | :--- | :--- | :--- |
| **工作方式** | 整个报文在建立的连接上连续传输 | 整个报文存储转发 | 将报文拆分成多个分组，进行存储转发 |
| **建立连接** | **需要** | 不需要 | 不需要 |
| **专用物理路径** | 是 | 否 | 否 |
| **优点** | 时延固定，实时性强 | 提高线路利用率 | 高效、灵活、迅速、可靠 |
| **缺点** | 线路利用率低，不适用于突发数据 | 时延长，需要大量缓存 | 有排队时延和额外开销 |
| **适用场景** | 传送时间远大于建立时间的连续大量数据 | 早期的电报通信 | 计算机网络中的突发数据传输 |
| **计费方式** | 按时长计费 | 按报文数量/长度计费 | 按分组数量/长度计费 |

### 五、分组交换网络的两种服务类型

分组交换网络可以提供两种服务：数据报服务和虚电路服务。

#### 1. 数据报网络 (Datagram Networks)

*   **服务类型**：提供**网络层无连接服务**。
*   **特点**：
    *   网络层不预先建立连接。
    *   每个分组被独立处理，其首部必须包含完整的源和目的地址。
    *   路由器不维护连接状态。
    *   同一会话的不同分组**可能经过不同的路径**，可能导致**失序到达**。
    *   目前因特网采用的就是数据报网络。

#### 2. 虚电路网络 (Virtual Circuit Networks)

*   **服务类型**：提供**网络层连接服务**。
*   **特点**：
    *   在数据传输前，必须先通过**信令协议 (Signaling Protocol)** 在源和目的地之间建立一条逻辑连接，称为**虚电路 (VC)**。
    *   每个分组携带一个较短的**虚电路标识符 (VC ID)**，而不是完整的目的地址。
    *   沿途的每台路由器为每条经过的虚电路**维护连接状态**。
    *   同一条虚电路的所有分组都**沿着建立时确定的路径**进行转发，保证了分组的**按序到达**。
    *   典型应用：ATM, 帧中继 (Frame Relay)。

### 易考点 & 难点

*   **易考点**:
    *   三种交换方式的基本原理和特点。
    *   电路交换的三个阶段。
    *   分组交换中数据报和虚电路的区别。
*   **难点**:
    *   理解为什么分组交换比报文交换的时延小（流水线效应）。
    *   理解虚电路与电路交换的区别（一个是逻辑连接，一个是物理连接）。
    *   分析不同交换方式的适用场景。