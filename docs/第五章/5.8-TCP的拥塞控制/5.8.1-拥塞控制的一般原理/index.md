# 5.8.1 拥塞控制的一般原理

这一节是第五章从"微观（点对点）"转向"宏观（全局网络）"的分水岭。

* **流量控制 (5.7)**：解决的是 **A 发太快，B 消化不了** 的问题（点对点）。
* **拥塞控制 (5.8)**：解决的是 **大家发太快，网络（路由器/链路）堵死了** 的问题（全局性）。

在考试中，这一节最常考的是**概念辨析（拥塞控制 vs 流量控制）**以及**拥塞带来的后果（死锁）**。

---

## 🟢 [交互演示]：网络吞吐量曲线 (拥塞的后果)

这个演示展示了网络负载（Load）增加时，吞吐量（Throughput）的变化。

<TCPCongestionControl />

**操作说明**：
1. 拖动滑块增加网络负载
2. 观察三条曲线的变化：
   - **理想情况（绿线）**：有多少发多少，直到带宽上限
   - **无拥塞控制（红线）**：一旦堵了，因为重传效应，吞吐量会断崖式下跌（死锁）
   - **有拥塞控制（蓝线）**：虽然不能无限增长，但能维持在一个较高的水平，不会崩盘

---

## 📚 核心考点笔记

### 1. 什么是拥塞 (Congestion)？

* **定义公式**：
  $$\sum \text{对资源的需求} > \text{可用资源}$$
* **资源包括**：链路带宽、交换机/路由器的缓存容量、处理机处理速度等。
* **后果**：
  1. **丢包**：路由器缓存满了，后来的包被扔掉。
  2. **延迟增加**：包在队列里排长队。
  3. **死锁 (Deadlock)**：最坏的情况。由于严重的拥塞，导致吞吐量降为 **0**，网络瘫痪。

### 2. 核心考点：拥塞控制 vs 流量控制 (★ 必考区别)

这是选择题最爱出的干扰项，必须分清：

| 特性 | **流量控制 (Flow Control)** | **拥塞控制 (Congestion Control)** |
| :--- | :--- | :--- |
| **范围** | **端到端** (点对点) | **全局性** (涉及所有主机、路由器) |
| **对象** | 抑制 **发送端** 发送速率 | 抑制 **所有源端** 发送速率 |
| **原因** | **接收端** 来不及接收 | **网络核心** 资源不足 (堵车) |
| **机制** | 接收方通告 **rwnd** (接收窗口) | 发送方感知网络计算 **cwnd** (拥塞窗口) |
| **目标** | 防止接收方缓存溢出 | 防止网络拥塞崩溃 |

**记忆技巧**：
- **流量控制**：A 和 B 两个人的事（点对点）
- **拥塞控制**：大家的事（全局性）

### 3. 开环控制 vs 闭环控制 (概念题)

考试可能会问你："以下哪种方法属于闭环控制？"

#### (1) 开环控制 (Open-loop) —— "事前预防"

* **思路**：在设计网络的时候就把参数定死，力求不发生拥塞。
* **特点**：系统运行起来后**不改变**策略（不看反馈）。
* **比喻**：像红绿灯定时控制，不管有没有车，红灯时间是固定的。
* **例子**：
  - 固定路由选择
  - 固定带宽分配
  - 固定缓存大小

#### (2) 闭环控制 (Closed-loop) —— "事后补救"

* **思路**：基于**反馈环路**。
* **特点**：**动态调整**。TCP 使用的就是闭环控制。
* **比喻**：像交警指挥，或者智能红绿灯，车多了绿灯就亮久一点。
* **例子**：
  - TCP 拥塞控制算法
  - 动态路由选择
  - 自适应带宽分配

##### 闭环控制的三个步骤

闭环控制包含三个关键步骤：

**1. 监测 (Monitor)**
* **任务**：监测网络系统，检测拥塞在何时、何处发生。
* **主要指标**：
  1. **由于缺少缓存空间而被丢弃的分组的百分数**
  2. **平均队列长度**
  3. **超时重传的分组数**
  4. **平均分组时延**
  5. **分组时延的标准差**，等等
* **关键**：这些指标的上升都标志着拥塞的增长。

**2. 传送 (Transmit)**
* **任务**：将拥塞发生的信息传送到可采取行动的地方。
* **方法**：
  1. **将拥塞发生的信息传送到产生分组的源站**（如 TCP 的拥塞控制）
  2. **在路由器转发的分组中保留一个比特或字段**，用该比特或字段的值表示网络没有拥塞或产生了拥塞（如 ECN - Explicit Congestion Notification）
  3. **周期性地发出探测分组**等

**3. 调整 (Adjust)**
* **任务**：调整网络系统的运行以解决出现的问题。
* **方法**：
  - 降低发送速率（如 TCP 的拥塞控制算法）
  - 调整路由选择
  - 调整缓存分配
* **时机问题**：
  - **过于频繁**：会使系统产生不稳定的振荡
  - **过于迟缓**：不具有任何实用价值
  - **选择正确的时间常数是相当困难的**

### 4. 拥塞的后果

#### (1) 丢包

* **原因**：路由器缓存满了，无法存储新的数据包。
* **后果**：数据包丢失，需要重传，进一步加剧拥塞。

#### (2) 延迟增加

* **原因**：数据包在队列中排队等待。
* **后果**：端到端延迟增加，影响实时应用。

#### (3) 死锁 (Deadlock)

* **定义**：由于严重的拥塞，导致吞吐量降为 **0**，网络瘫痪。
* **原因**：
  - 路由器缓存全部被占用
  - 没有空间接收新数据包
  - 无法转发数据包
  - 网络完全停止工作
* **后果**：网络完全瘫痪，需要人工干预恢复。

---

## 🎓 考试避坑指南

### 考点一：拥塞控制 vs 流量控制的区别

* **题目**：以下哪个是流量控制的特点？
* **选项**：
  - A. 全局性
  - B. 端到端
  - C. 抑制所有源端
  - D. 基于网络拥塞
* **答**：**B. 端到端**

### 考点二：拥塞的定义

* **题目**：什么是网络拥塞？
* **答**：对资源的需求大于可用资源，导致网络性能下降。

### 考点三：开环控制 vs 闭环控制

* **题目**：TCP 拥塞控制属于哪种控制方式？
* **答**：**闭环控制**（基于反馈，动态调整）

### 考点四：拥塞的后果

* **题目**：严重的网络拥塞可能导致什么后果？
* **答**：**死锁**（吞吐量降为 0，网络瘫痪）

### 考点五：cwnd vs rwnd

* **题目**：拥塞控制使用哪个窗口？
* **答**：**cwnd (拥塞窗口)**，由发送方根据网络拥塞情况计算
* **注意**：流量控制使用 **rwnd (接收窗口)**，由接收方通告

### 考点六：拥塞监测指标

* **题目**：以下哪些是拥塞监测的主要指标？
* **答**：
  1. 由于缺少缓存空间而被丢弃的分组的百分数
  2. 平均队列长度
  3. 超时重传的分组数
  4. 平均分组时延
  5. 分组时延的标准差
* **关键**：这些指标的上升都标志着拥塞的增长

### 考点七：闭环控制的步骤

* **题目**：闭环控制包含哪三个步骤？
* **答**：
  1. **监测**：检测拥塞在何时、何处发生
  2. **传送**：将拥塞信息传送到可采取行动的地方
  3. **调整**：调整网络系统的运行以解决出现的问题

---

## 🎯 易错点提醒

1. **流量控制 vs 拥塞控制**：
   - 流量控制：点对点，解决接收方慢的问题
   - 拥塞控制：全局性，解决网络堵的问题

2. **rwnd vs cwnd**：
   - rwnd：接收窗口，用于流量控制
   - cwnd：拥塞窗口，用于拥塞控制
   - 发送窗口 = min(rwnd, cwnd)

3. **开环 vs 闭环**：
   - 开环：事前预防，固定参数
   - 闭环：事后补救，动态调整
   - TCP 使用闭环控制

4. **死锁的定义**：
   - 不是简单的延迟增加
   - 而是吞吐量降为 0，网络完全瘫痪

5. **拥塞的原因**：
   - 不是单个主机的问题
   - 而是整个网络资源不足的问题

---

## 总结

**一句话总结**：5.8.1 节主要为后面的 TCP 拥塞控制算法做铺垫。

**核心要点**：
1. **区别**：流量控制（A对B）vs 拥塞控制（全局）
2. **后果**：严重的拥塞会导致**死锁**（吞吐量归零）
3. **TCP 策略**：属于 **闭环控制**（基于反馈，动态调整）
4. **窗口**：拥塞控制使用 **cwnd**，流量控制使用 **rwnd**

